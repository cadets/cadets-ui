# CADETS UI

This is a prototype for the CADETS/OPUS UI implemented with only JavaScript,
HTML and CSS.


## Getting started

### Install dependencies

This UI depends on:

[horizontal]
http://neo4j.com[Neo4j]::
Graph database to hold
https://www.cl.cam.ac.uk/research/dtg/fresco/opus[OPUS] provenance graph

https://www.npmjs.com[npm]::
https://nodejs.org[Node] package manager

Start by installing these tools with your system's package manager
(https://debian-handbook.info/browse/stable/sect.apt-get.html[apt-get],
https://chocolatey.org[Chocolatey],
https://brew.sh[Homebrew],
https://www.freebsd.org/doc/handbook/pkgng-intro.html[pkg], …).
All other dependencies are installed using `npm`:

```terminal
$ npm install
⸨        ░░░░░░░░░░⸩ ⠦ fetchMetadata: sill mapToRegistry uri https://registry
[...]
> node lib/post_install.js

added 594 packages in 5.621s
```


### Get OPUS data and start Neo4j

In order to visualize OPUS provenance data, you will need a running Neo4j
instance containing a graph database. Describing this process is out of scope
for the UI, but we hope to have some public instructions to link to soon.
Once you have a graph database in an appropriate place
(e.g., `/var/db/neo4j/databases/graph.db`),
start running Neo4j:

```terminal
# neo4j start
Active database: graph.db
Directories in use:
  home:         /usr/local/neo4j
  config:       /usr/local/neo4j/../etc
  logs:         /var/log
  plugins:      /usr/local/lib/neo4j/plugins
  import:       /usr/local/neo4j/import
  data:         /var/db/neo4j
  certificates: /usr/local/etc/neo4j-certificates
  run:          /var/run
Starting Neo4j.
Started neo4j (pid 93067). It is available at http://localhost:7474/
There may be a short delay until the server is ready.
See /var/log/neo4j.log for current status.
```

You can check that Neo4j is running correctly by visiting
http://localhost:7474/.
Ensure that you can connect to the database (`:server connect`);
the first time you connect you will need to choose a database password.


### Build and run demo UI

We use https://webpack.js.org[Webpack] to manage our scripts and style
definitions together with their JavaScript dependencies.
You can build our code using the command `npm run build`:

```terminal
$ npm run build

> CADETS_UI_JS@1.0.0 build /usr/home/jon/CADETS/ui
> webpack --config webpack.prod.js

clean-webpack-plugin: /usr/home/jon/CADETS/ui/dist has been removed.

Hash: d341ea6b74e9d30e90ed
Version: webpack 3.10.0
Time: 20909ms
    Asset     Size  Chunks             Chunk Names
                               Asset       Size  Chunks                    Chunk Names
2900a1ec47b7252ab90bc098a14bcc8a.png    5.79 kB          [emitted]
2883d56f655c6f2f262465069957d804.png    13.3 kB          [emitted]
96bf620db9e7e70833c7f13717a7e61f.png    4.75 kB          [emitted]
a6712c2111b9a9df9b9dbcfaa03e582a.svg    23.2 kB          [emitted]
[...]
 [211] ./src/goldenLayoutHTML.js 4.68 kB {0} [built]
    + 197 hidden modules
Child html-webpack-plugin for "index.html":
     1 asset
       [2] (webpack)/buildin/global.js 509 bytes {0} [built]
       [3] (webpack)/buildin/module.js 517 bytes {0} [built]
        + 2 hidden modules
```

The compiles our JavaScript files together with their dependencies into an
optimized and "minified" file called `bundle.js` and transforms images into
cache-friendly (but human-unfriendly) names like `1531d[…]2af.svg`.
This content is optimized for serving quickly via the Web rather than debugging.
A more developer-friendly way to build the assets is `webpack-dev-server`,
which compiles unoptimized versions of JavaScript and recompiles them whenever
the source files change and serves them from http://localhost:8080:

```terminal
$ npm run start

> CADETS_UI_JS@1.0.0 start /usr/home/jon/CADETS/ui
> webpack-dev-server --open --config webpack.dev.js

clean-webpack-plugin: /usr/home/jon/CADETS/ui/dist has been removed.
Project is running at http://localhost:8080/
webpack output is served from /
Content not from webpack is served from ./dist
webpack: wait until bundle finished: /
Hash: 30340c68845bf485621a
Version: webpack 3.10.0
Time: 3725ms
                               Asset       Size  Chunks                    Chunk
 Names
a6712c2111b9a9df9b9dbcfaa03e582a.svg    23.2 kB          [emitted]
2900a1ec47b7252ab90bc098a14bcc8a.png    5.79 kB          [emitted]
[...]
[./src/neo4jQueries.js] ./src/neo4jQueries.js 17.4 kB {0} [built]
    + 222 hidden modules
Child html-webpack-plugin for "index.html":
     1 asset
    [./node_modules/html-webpack-plugin/lib/loader.js!./node_modules/html-webpack-plugin/default_index.ejs] ./node_modules/html-webpack-plugin/lib/loader.js!./node_modules/html-webpack-plugin/default_index.ejs 538 bytes {0} [built]
    [./node_modules/lodash/lodash.js] ./node_modules/lodash/lodash.js 540 kB {0} [built]
    [./node_modules/webpack/buildin/global.js] (webpack)/buildin/global.js 509 bytes {0} [built]
    [./node_modules/webpack/buildin/module.js] (webpack)/buildin/module.js 517 bytes {0} [built]
webpack: Compiled successfully.
```
